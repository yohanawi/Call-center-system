!function(e){e.fn.craftmap=function(t){var n={cookies:!1,fullscreen:!1,container:{name:"imgContent"},image:{width:1475,height:1200,name:"imgMap"},map:{position:"center"},marker:{name:"marker",center:!0,popup:!0,popup_name:"popup",onClick:function(){},onClose:function(){}},controls:{init:!0,name:"controls",onClick:function(){}},preloader:{init:!0,name:"preloader",onLoad:function(){}}},i=e.extend(!0,n,t);return this.each(function(){var t=e(this),o=t.find("."+i.image.name),a={init:function(){this._container.init(),i.fullscreen&&(this.fullscreen.init(),this.fullscreen.resize()),this._globals.init(),i.preloader.init&&this.preloader.init(),this.map.init(),this.marker.init(),i.controls.init&&this.controls.init()},_container:{init:function(){a._container.css(),a._container.wrap()},css:function(){var e={width:"100%",height:"100%"};o.css(e);var n={position:"relative",overflow:"hidden",cursor:"move"};t.css(n)},wrap:function(){var n={zIndex:"1",position:"absolute",width:i.image.width,height:i.image.height};t.wrapInner(e("<div />").addClass(i.container.name).css(n))}},_globals:{init:function(){C=t.find("."+i.container.name),MARKER=C.find("."+i.marker.name),md=!1,mx=0,my=0,ex=0,ey=0,delta=0,mv=[],interval=0,n={w:t.width(),h:t.height()},I={w:C.width(),h:C.height()},i.controls.init&&(CONTROLS=e("."+i.controls.name).find("a"))}},_mouse:{get:function(e){var t=e.pageX,n=e.pageY;return{x:t,y:n}},update:function(e){var t=a._mouse.get(e),n=t.x,o=t.y,r=n-mx,s=o-my,l=ey+s,c=ex+r,u=a.map.position.check(c,l),d={top:u.y,left:u.x};C.css(d),i.cookies&&a.cookies.create("position",u.x+","+u.y,7)},decelerate:function(){var e=mv.length,t=0;if(e){var n=20;interval=setInterval(function(){var i=C.position(),o=i.left,r=i.top,s=(n-t)/n,l=e-1,c=(mv[l].x-mv[0].x)/e,u=(mv[l].y-mv[0].y)/e,d=c*s,h=u*s,f=a.map.position.check(d+o,h+r),p={left:f.x,top:f.y};C.css(p),++t,t==n&&(clearInterval(interval),t=0)},40)}},wheel:{init:function(){t.handle=function(e){e.preventDefault(),e||(e=window.event),e.wheelDelta?(delta=e.wheelDelta/120,window.opera&&(delta=-delta)):e.detail&&(delta=-e.detail/3)},window.addEventListener&&window.addEventListener("DOMMouseScroll",t.handle,!1),window.onmousewheel=document.onmousewheel=t.handle},remove:function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",t.handle,!1),window.onmousewheel=document.onmousewheel=null}}},fullscreen:{init:function(){var n=e(window),i=n.width(),o=n.height(),a={width:i,height:o};t.css(a)},resize:function(){e(window).resize(function(){a.fullscreen.init(),n={w:t.width(),h:t.height()}})}},cookies:{create:function(e,t,n){if(n){var i=new Date,o=i.getTime()+1e3*60*60*24*n;i.setTime(o);var a="; expires="+i.toGMTString()}else var a="";document.cookie=e+"="+t+a+"; path=/"},erase:function(e){cookies.create(e,"",-1)},read:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}},preloader:{init:function(){var t=new Image,n=o.attr("src");a.preloader.create(),e(t).addClass(i.image.name).attr("src",n).load(function(){var t=e(this),n={width:this.width,height:this.height};t.css(n),o.remove(),a.preloader.remove(),i.preloader.onLoad.call(this,t,n)}).appendTo(C)},create:function(){var n={position:"absolute",zIndex:"10",top:"0",left:"0",width:"100%",height:"100%"};t.append(e("<div />").addClass(i.preloader.name).css(n))},remove:function(){t.find("."+i.preloader.name).fadeOut(400,function(){var t=e(this);t.remove()})}},map:{init:function(){a.map.position.set(),a.map.move()},position:{set:function(){if(i.cookies)if("null"!=typeof a.cookies.read("position"))var e=a.cookies.read("position").split(","),t=e[0],o=e[1];else var t=(n.w-I.w)/2,o=(n.h-I.h)/2;else{var e=i.map.position;switch(e){case"center":var t=(n.w-I.w)/2,o=(n.h-I.h)/2;break;case"top_left":var t=0,o=0;break;case"top_right":var t=n.w-I.w,o=0;break;case"bottom_left":var t=0,o=n.h-I.h;break;case"bottom_right":var t=n.w-I.w,o=n.h-I.h;break;default:var r=e.split(" "),t=-r[0],o=-r[1],r=a.map.position.check(t,o),t=r.x,o=r.y}}var s={top:o,left:t};C.css(s)},check:function(e,t){return t<n.h-I.h?t=n.h-I.h:t>0&&(t=0),e<n.w-I.w?e=n.w-I.w:e>0&&(e=0),{x:e,y:t}}},move:function(){C.bind({mousedown:function(e){md=!0;var t=a._mouse.get(e);mx=t.x,my=t.y;var n=C.position();return ex=n.left,ey=n.top,mv=[],clearInterval(interval),a._mouse.update(e),!1},mousemove:function(e){if(md){a._mouse.update(e);var t=a._mouse.get(e),n={x:t.x,y:t.y};mv.push(n),mv.length>15&&mv.pop()}return!1},mouseup:function(e){return md&&(md=!1),a._mouse.decelerate(e),!1},mouseout:function(){return md&&(md=!1),a._mouse.wheel.remove(),!1},mouseover:function(e){return a._mouse.wheel.init(e),!1},mousewheel:function(e){a._zoom.init(e)}})}},_zoom:{init:function(){}},marker:{init:function(){a.marker.set(),a.marker.open(),a.marker.close()},set:function(){MARKER.each(function(){var t=e(this),n=t.attr("data-coords").split(",");x=parseInt(n[0]),y=parseInt(n[1]),css={position:"absolute",zIndex:"2",top:y,left:x},t.css(css)}).wrapInner(e("<div />").addClass(i.marker.name+"Content").hide())},open:function(){MARKER.live("click",function(){var t=e(this),o=t.attr("id"),r=i.marker,s=t.width(),l=t.height(),c=t.position(),u=c.left,d=c.top,o=t.attr("id"),h=t.find("."+r.name+"Content").html();if(r.center){var f=-d+n.h/2-l/2,p=-u+n.w/2-s/2,m=a.map.position.check(p,f),g={top:m.y,left:m.x};C.animate(g)}if(r.popup){e("."+r.popup_name).remove();var v={position:"absolute",zIndex:"3"};t.after(e("<div />").addClass(r.popup_name+" "+o).css(v).html(h).append(e("<a />").addClass("close")));var T=t.next("."+r.popup_name),E=T.innerWidth(),y=T.innerHeight(),b=0,D=0;b=0>u-E?u:u+E/2>I.w?u-E+s:u-(E/2-s/2),D=0>d-y?d+l+l/1.5:d-y-l/1.5,0>u-E&&0>d-y?(b=u+2*s,D=d-l/2):0>d-y&&u+E/2>I.w?(b=u-E-s/2,D=d-l/2):d+y>I.h&&u+E/2>I.w?(b=u-E+s,D=d-y-l/2):d+y>I.h&&0>u-E&&(b=u,D=d-y-l/2);var v={left:b,top:D};T.css(v)}return a.controls.active.set(o),r.onClick.call(this,t,T),!1})},close:function(){C.find(".close").live("click",function(){var t=e(this),n=t.parents("."+i.marker.popup_name),o=n.prev("."+i.marker.name);return n.remove(),a.controls.active.remove(),i.marker.onClose.call(this,o,n),!1})}},controls:{init:function(){a.controls.set()},set:function(){CONTROLS.click(function(){var t=e(this),n=t.attr("rel");return div=C.find("."+i.marker.name).filter("#"+n),div.trigger("click"),i.controls.onClick.call(this,div),!1})},active:{set:function(e){i.controls.init&&CONTROLS.removeClass("active").filter(function(){return this.rel==e}).addClass("active")},remove:function(){i.controls.init&&CONTROLS.removeClass("active")}}}};a.init()})}}(jQuery);