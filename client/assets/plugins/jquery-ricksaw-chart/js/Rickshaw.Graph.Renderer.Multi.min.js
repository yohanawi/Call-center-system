Rickshaw.namespace("Rickshaw.Graph.Renderer.Multi"),Rickshaw.Graph.Renderer.Multi=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"multi",initialize:function(l,e){l(e)},defaults:function(l){return Rickshaw.extend(l(),{unstack:!0,fill:!1,stroke:!0})},domain:function(l){this.graph.stackData();var e=[],t=this._groups();this._stack(t),t.forEach(function(t){var n=t.series.filter(function(l){return!l.disabled}).map(function(l){return l.stack});if(n.length){var i=l(n);e.push(i)}});var n=d3.min(e.map(function(l){return l.x[0]})),i=d3.max(e.map(function(l){return l.x[1]})),a=d3.min(e.map(function(l){return l.y[0]})),o=d3.max(e.map(function(l){return l.y[1]}));return{x:[n,i],y:[a,o]}},_groups:function(){var l=this.graph,e={};l.series.forEach(function(t){if(!t.disabled){if(!e[t.renderer]){var n="http://www.w3.org/2000/svg",i=document.createElementNS(n,"g");l.vis[0][0].appendChild(i);var a=l._renderers[t.renderer];e[t.renderer]={renderer:a,series:[],vis:d3.select(i)}}e[t.renderer].series.push(t)}},this);var t=[];return Object.keys(e).forEach(function(l){var n=e[l];t.push(n)}),t},_stack:function(l){return l.forEach(function(l){var e=l.series.filter(function(l){return!l.disabled}),t=e.map(function(l){return l.stack});if(!l.renderer.unstack){var n=d3.layout.stack(),i=Rickshaw.clone(n(t));e.forEach(function(l,e){l._stack=Rickshaw.clone(i[e])})}},this),l},render:function(){this.graph.series.forEach(function(l){if(!l.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var l=this._groups();l=this._stack(l),l.forEach(function(l){var e=l.series.filter(function(l){return!l.disabled});l.renderer.render({series:e,vis:l.vis}),e.forEach(function(l){l.stack=l._stack||l.stack||l.data})})}});