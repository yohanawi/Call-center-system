Rickshaw.namespace("Rickshaw.Graph.Annotate"),Rickshaw.Graph.Annotate=function(l){this.graph=l.graph,this.elements={timeline:l.element};var e=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(l,t,n){e.data[l]=e.data[l]||{boxes:[]},e.data[l].boxes.push({content:t,end:n})},this.update=function(){Rickshaw.keys(e.data).forEach(function(l){var t=e.data[l],n=e.graph.x(l);if(0>n||n>e.graph.x.range()[1])return t.element&&(t.line.classList.add("offscreen"),t.element.style.display="none"),t.boxes.forEach(function(l){l.rangeElement&&l.rangeElement.classList.add("offscreen")}),void 0;if(!t.element){var i=t.element=document.createElement("div");i.classList.add("annotation"),this.elements.timeline.appendChild(i),i.addEventListener("click",function(){i.classList.toggle("active"),t.line.classList.toggle("active"),t.boxes.forEach(function(l){l.rangeElement&&l.rangeElement.classList.toggle("active")})},!1)}t.element.style.left=n+"px",t.element.style.display="block",t.boxes.forEach(function(l){var i=l.element;if(i||(i=l.element=document.createElement("div"),i.classList.add("content"),i.innerHTML=l.content,t.element.appendChild(i),t.line=document.createElement("div"),t.line.classList.add("annotation_line"),e.graph.element.appendChild(t.line),l.end&&(l.rangeElement=document.createElement("div"),l.rangeElement.classList.add("annotation_range"),e.graph.element.appendChild(l.rangeElement))),l.end){var o=n,a=Math.min(e.graph.x(l.end),e.graph.x.range()[1]);o>a&&(a=n,o=Math.max(e.graph.x(l.end),e.graph.x.range()[0]));var s=a-o;l.rangeElement.style.left=o+"px",l.rangeElement.style.width=s+"px",l.rangeElement.classList.remove("offscreen")}t.line.classList.remove("offscreen"),t.line.style.left=n+"px"})},this)},this.graph.onUpdate(function(){e.update()})};