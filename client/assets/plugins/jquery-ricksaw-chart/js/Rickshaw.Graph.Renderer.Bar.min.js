Rickshaw.namespace("Rickshaw.Graph.Renderer.Bar"),Rickshaw.Graph.Renderer.Bar=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"bar",defaults:function(l){var e=Rickshaw.extend(l(),{gapSize:.05,unstack:!1});return delete e.tension,e},initialize:function(l,e){e=e||{},this.gapSize=e.gapSize||this.gapSize,l(e)},domain:function(l){var e=l(),t=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return e.x[1]+=Number(t.magnitude),e},barWidth:function(l){var e=this._frequentInterval(l.stack),t=this.graph.x(l.stack[0].x+e.magnitude*(1-this.gapSize));return t},render:function(l){l=l||{};var e=this.graph,t=l.series||e.series,n=l.vis||e.vis;n.selectAll("*").remove();var i=this.barWidth(t.active()[0]),a=0,o=t.filter(function(l){return!l.disabled}).length,s=this.unstack?i/o:i,r=function(l){var t=[1,0,0,l.y<0?-1:1,0,l.y<0?2*e.y.magnitude(Math.abs(l.y)):0];return"matrix("+t.join(",")+")"};t.forEach(function(l){if(!l.disabled){this.barWidth(l);var t=n.selectAll("path").data(l.stack.filter(function(l){return null!==l.y})).enter().append("svg:rect").attr("x",function(l){return e.x(l.x)+a}).attr("y",function(l){return e.y(l.y0+Math.abs(l.y))*(l.y<0?-1:1)}).attr("width",s).attr("height",function(l){return e.y.magnitude(Math.abs(l.y))}).attr("transform",r);Array.prototype.forEach.call(t[0],function(e){e.setAttribute("fill",l.color)}),this.unstack&&(a+=s)}},this)},_frequentInterval:function(l){for(var e={},t=0;t<l.length-1;t++){var n=l[t+1].x-l[t].x;e[n]=e[n]||0,e[n]++}var i={count:0,magnitude:1};return Rickshaw.keys(e).forEach(function(l){i.count<e[l]&&(i={count:e[l],magnitude:l})}),i}});