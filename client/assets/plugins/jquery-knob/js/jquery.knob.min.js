!function(e){"use strict";var t={},l=Math.max,n=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var l=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var n;for(n in t)l.o[n]=t[n];l.init(),l._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"==this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null,error:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var n=e(this);l.i[t]=n,l.v[t]=n.val(),n.bind("change",function(){var e={};e[t]=n.val(),l.val(e)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){l.val(l._validate(l.$.val()))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,this.c?(this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=0!==this.o.width%1&&this.o.width.indexOf("%"),this.relativeHeight=0!==this.o.height%1&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+'"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this):(this.o.error&&this.o.error(),void 0)},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;l.g=l.c,l.clear(),l.dH&&(e=l.dH()),e!==!1&&l.draw()},this._touch=function(e){var n=function(e){var t=l.xy2val(e.originalEvent.touches[l.t].pageX,e.originalEvent.touches[l.t].pageY);t!=l.cv&&(l.cH&&l.cH(t)===!1||(l.change(l._validate(t)),l._draw()))};return this.t=t.c.t(e),n(e),t.c.d.bind("touchmove.k",n).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),l.rH&&l.rH(l.cv)===!1||l.val(l.cv)}),this},this._mouse=function(e){var n=function(e){var t=l.xy2val(e.pageX,e.pageY);t!=l.cv&&(l.cH&&l.cH(t)===!1||(l.change(l._validate(t)),l._draw()))};return n(e),t.c.d.bind("mousemove.k",n).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),l.eH&&l.eH()===!1)return;l.cancel()}}).bind("mouseup.k",function(){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),l.rH&&l.rH(l.cv)===!1||l.val(l.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),l._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),l._xy()._touch(e)}),this.relative&&e(window).resize(function(){l._carve().init(),l._draw()}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){return~~((0>e?-.5:.5)+e/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var l;return e=e.substring(1,7),l=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+l[0]+","+l[1]+","+l[2]+","+t+")"},this.copy=function(e,t){for(var l in e)t[l]=e[l]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e){return null==e?this.v:(this.cv=this.o.stopper?l(n(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.v),this._draw(),void 0)},this.xy2val=function(e,t){var i,o;return i=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&0>i&&i>-.5?i=0:0>i&&(i+=this.PI2),o=~~(.5+i*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(o=l(n(o,this.o.max),this.o.min)),o},this.listen=function(){var t,i,o=this,a=function(e){e.preventDefault();var t=e.originalEvent,l=t.detail||t.wheelDeltaX,n=t.detail||t.wheelDeltaY,i=parseInt(o.$.val())+(l>0||n>0?o.o.step:0>l||0>n?-o.o.step:0);o.cH&&o.cH(i)===!1||o.val(i)},r=1,s={37:-o.o.step,38:o.o.step,39:o.o.step,40:-o.o.step};this.$.bind("keydown",function(a){var c=a.keyCode;if(c>=96&&105>=c&&(c=a.keyCode=c-48),t=parseInt(String.fromCharCode(c)),isNaN(t)&&(13!==c&&8!==c&&9!==c&&189!==c&&a.preventDefault(),e.inArray(c,[37,38,39,40])>-1)){a.preventDefault();var u=parseInt(o.$.val())+s[c]*r;o.o.stopper&&(u=l(n(u,o.o.max),o.o.min)),o.change(u),o._draw(),i=window.setTimeout(function(){r*=2},30)}}).bind("keyup",function(){isNaN(t)?i&&(window.clearTimeout(i),i=null,r=1,o.val(o.$.val())):o.$.val()>o.o.max&&o.$.val(o.o.max)||o.$.val()<o.o.min&&o.$.val(o.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",a),this.$.bind("mousewheel DOMMouseScroll",a)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=l(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(e)},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var e,t,l=this.g,n=this.angle(this.cv),i=this.startAngle,o=i+n,a=1;l.lineWidth=this.lineWidth,l.lineCap=this.lineCap,this.o.cursor&&(i=o-this.cursorExt)&&(o+=this.cursorExt),l.beginPath(),l.strokeStyle=this.o.bgColor,l.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),l.stroke(),this.o.displayPrevious&&(t=this.startAngle+this.angle(this.v),e=this.startAngle,this.o.cursor&&(e=t-this.cursorExt)&&(t+=this.cursorExt),l.beginPath(),l.strokeStyle=this.pColor,l.arc(this.xy,this.xy,this.radius,e,t,!1),l.stroke(),a=this.cv==this.v),l.beginPath(),l.strokeStyle=a?this.o.fgColor:this.fgColor,l.arc(this.xy,this.xy,this.radius,i,o,!1),l.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(l){return this.each(function(){var n=new t.Dial;n.o=l,n.$=e(this),n.run()}).parent()}}(jQuery);