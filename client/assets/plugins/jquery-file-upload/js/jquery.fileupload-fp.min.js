!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{process:[],add:function(t,n){e(this).fileupload("process",n).done(function(){n.submit()})}},processActions:{load:function(n,i){var o=this,a=n.files[n.index],s=e.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==e.type(i.maxFileSize)||a.size<i.maxFileSize)&&(!i.fileTypes||i.fileTypes.test(a.type))?t(a,function(e){return e.src?(n.img=e,s.resolveWith(o,[n]),void 0):s.rejectWith(o,[n])}):s.rejectWith(o,[n]),s.promise()},resize:function(n,i){var o,a=n.img;return i=e.extend({canvas:!0},i),a&&(o=t.scale(a,i),(o.width!==a.width||o.height!==a.height)&&(n.canvas=o)),n},save:function(t){if(!t.canvas)return t;var n=this,i=t.files[t.index],o=i.name,a=e.Deferred(),s=function(e){e.name||(i.type===e.type?e.name=i.name:i.name&&(e.name=i.name.replace(/\..+$/,"."+e.type.substr(6)))),t.files[t.index]=e,a.resolveWith(n,[t])};return t.canvas.mozGetAsFile?s(t.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(i.type)&&o||(o&&o.replace(/\..+$/,"")||"blob")+".png",i.type)):t.canvas.toBlob(s,i.type),a.promise()}},_processFile:function(t,n,i){var o=this,a=e.Deferred().resolveWith(o,[{files:t,index:n}]),s=a.promise();return o._processing+=1,e.each(i.process,function(e,t){s=s.pipe(function(e){return o.processActions[t.action].call(this,e,t)})}),s.always(function(){o._processing-=1,0===o._processing&&o.element.removeClass("fileupload-processing")}),1===o._processing&&o.element.addClass("fileupload-processing"),s},process:function(t){var n=this,i=e.extend({},this.options,t);return i.process&&i.process.length&&this._isXHRUpload(i)&&e.each(t.files,function(o){n._processingQueue=n._processingQueue.pipe(function(){var a=e.Deferred();return n._processFile(t.files,o,i).always(function(){a.resolveWith(n)}),a.promise()})}),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})});