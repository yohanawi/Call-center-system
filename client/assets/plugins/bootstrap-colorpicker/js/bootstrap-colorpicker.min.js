!function(t){var e=function(t){this.value={h:1,s:1,b:1,a:1},this.setColor(t)};e.prototype={constructor:e,setColor:function(e){e=e.toLowerCase();var i=this;t.each(o.stringParsers,function(t,s){var a=s.re.exec(e),n=a&&s.parse(a),r=s.space||"rgba";return n?(i.value="hsla"===r?o.RGBtoHSB.apply(null,o.HSLtoRGB.apply(null,n)):o.RGBtoHSB.apply(null,n),!1):!0})},setHue:function(t){this.value.h=1-t},setSaturation:function(t){this.value.s=t},setLightness:function(t){this.value.b=1-t},setAlpha:function(t){this.value.a=parseInt(100*(1-t),10)/100},toRGB:function(t,e,i,s){t||(t=this.value.h,e=this.value.s,i=this.value.b),t*=360;var o,a,n,r,l;return t=t%360/60,l=i*e,r=l*(1-Math.abs(t%2-1)),o=a=n=i-l,t=~~t,o+=[l,r,0,0,r,l][t],a+=[r,l,l,r,0,0][t],n+=[0,0,r,l,l,r][t],{r:Math.round(255*o),g:Math.round(255*a),b:Math.round(255*n),a:s||this.value.a}},toHex:function(t,e,i,s){var o=this.toRGB(t,e,i,s);return"#"+(1<<24|parseInt(o.r)<<16|parseInt(o.g)<<8|parseInt(o.b)).toString(16).substr(1)},toHSL:function(t,e,i,s){t||(t=this.value.h,e=this.value.s,i=this.value.b);var o=t,a=(2-e)*i,n=e*i;return n/=a>0&&1>=a?a:2-a,a/=2,n>1&&(n=1),{h:o,s:n,l:a,a:s||this.value.a}}};var i=0,s=function(e,s){i++,this.element=t(e).attr("data-colorpicker-guid",i);var a=s.format||this.element.data("color-format")||"hex";this.format=o.translateFormats[a],this.isInput=this.element.is("input"),this.component=this.element.is(".colorpicker-component")?this.element.find(".add-on, .input-group-addon"):!1,this.picker=t(o.template).attr("data-colorpicker-guid",i).appendTo("body").on("mousedown.colorpicker",t.proxy(this.mousedown,this)),this.isInput?this.element.on({"focus.colorpicker":t.proxy(this.show,this),"keyup.colorpicker":t.proxy(this.update,this)}):this.component?this.component.on({"click.colorpicker":t.proxy(this.show,this)}):this.element.on({"click.colorpicker":t.proxy(this.show,this)}),("rgba"===a||"hsla"===a)&&(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update(),t(t.proxy(function(){this.element.trigger("create",[this])},this))};s.prototype={constructor:s,show:function(e){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),t(window).on("resize.colorpicker",t.proxy(this.place,this)),this.isInput||e&&(e.stopPropagation(),e.preventDefault()),t(document).on({"mousedown.colorpicker":t.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color})},update:function(){var t=this.isInput?this.element.prop("value"):this.element.data("color");("undefined"==typeof t||null===t)&&(t="#ffffff"),this.color=new e(t),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},hide:function(){this.picker.hide(),t(window).off("resize",this.place),t(document).off({mousedown:this.hide}),this.isInput?""!==this.element.val()&&this.element.prop("value",this.format.call(this)).trigger("change"):(this.component&&""!==this.element.find("input").val()&&this.element.find("input").prop("value",this.format.call(this)).trigger("change"),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hidePicker",color:this.color})},place:function(){var t=this.component?this.component.offset():this.element.offset();this.picker.css({top:t.top+this.height,left:t.left})},destroy:function(){t(".colorpicker[data-colorpicker-guid="+this.element.attr("data-colorpicker-guid")+"]").remove(),this.element.removeData("colorpicker").removeAttr("data-colorpicker-guid").off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.trigger("destroy",[this])},setValue:function(t){this.isInput?this.element.prop("value",t):(this.element.find("input").val(t),this.element.data("color",t)),this.update(),this.element.trigger({type:"changeColor",color:this.color})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(t){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(e){e.stopPropagation(),e.preventDefault();var i=t(e.target),s=i.closest("div");if(!s.is(".colorpicker")){if(s.is(".colorpicker-saturation"))this.slider=t.extend({},o.sliders.saturation);else if(s.is(".colorpicker-hue"))this.slider=t.extend({},o.sliders.hue);else{if(!s.is(".colorpicker-alpha"))return!1;this.slider=t.extend({},o.sliders.alpha)}var a=s.offset();this.slider.knob=s.find("i")[0].style,this.slider.left=e.pageX-a.left,this.slider.top=e.pageY-a.top,this.pointer={left:e.pageX,top:e.pageY},t(document).on({"mousemove.colorpicker":t.proxy(this.mousemove,this),"mouseup.colorpicker":t.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(t){t.stopPropagation(),t.preventDefault();var e=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((t.pageX||this.pointer.left)-this.pointer.left))),i=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((t.pageY||this.pointer.top)-this.pointer.top)));if(this.slider.knob.left=e+"px",this.slider.knob.top=i+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,e/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,i/100),this.previewColor(),this.isInput)try{this.element.val(this.format.call(this)).trigger("change")}catch(t){this.element.val(this.color.toHex()).trigger("change")}else try{this.element.find("input").val(this.format.call(this)).trigger("change")}catch(t){this.element.find("input").val(this.color.toHex()).trigger("change")}return this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(e){return e.stopPropagation(),e.preventDefault(),t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},t.fn.colorpicker=function(e,i){return this.each(function(){var o=t(this),a=o.data("colorpicker"),n="object"==typeof e&&e;a?"string"==typeof e&&a[e](i):"destroy"!==e&&o.data("colorpicker",a=new s(this,t.extend({},t.fn.colorpicker.defaults,n)))})},t.fn.colorpicker.defaults={},t.fn.colorpicker.Constructor=s;var o={translateFormats:{rgb:function(){var t=this.color.toRGB();return"rgb("+t.r+","+t.g+","+t.b+")"},rgba:function(){var t=this.color.toRGB();return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},hsl:function(){var t=this.color.toHSL();return"hsl("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%)"},hsla:function(){var t=this.color.toHSL();return"hsla("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%,"+t.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(t,e,i,s){t/=255,e/=255,i/=255;var o,a,n,r;return n=Math.max(t,e,i),r=n-Math.min(t,e,i),o=0===r?null:n===t?(e-i)/r:n===e?(i-t)/r+2:(t-e)/r+4,o=60*((o+360)%6)/360,a=0===r?0:r/n,{h:o||1,s:a,b:n,a:s||1}},HueToRGB:function(t,e,i){return 0>i?i+=1:i>1&&(i-=1),1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t},HSLtoRGB:function(t,e,i,s){0>e&&(e=0);var a;a=.5>=i?i*(1+e):i+e-i*e;var n=2*i-a,r=t+1/3,l=t,h=t-1/3,c=Math.round(255*o.HueToRGB(n,a,r)),d=Math.round(255*o.HueToRGB(n,a,l)),u=Math.round(255*o.HueToRGB(n,a,h));return[c,d,u,s||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1]/360,t[2]/100,t[3]/100,t[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery);